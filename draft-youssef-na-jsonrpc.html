<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Implementation of JSON-RPC in kotlinx.rpc</title>
<meta content="Youssef Shoaib" name="author">
<meta content="
       This document specifies an implementation of the JSON-RPC 2.0 protocol in the kotlinx.rpc Kotlin Multiplatform library. It provides both a core, transport-agnostic API, as well as Ktor integrations. Further, a quasi-protocol is defined to support bidirectional streaming via Flows over JSON-RPC. 
    " name="description">
<meta content="xml2rfc 3.31.0" name="generator">
<meta content="rpc" name="keyword">
<meta content="kotlin" name="keyword">
<meta content="json" name="keyword">
<meta content="draft-youssef-na-jsonrpc-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.31.0
    Python 3.12.12
    ConfigArgParse 1.7
    google-i18n-address 3.1.1
    intervaltree 3.2.1
    Jinja2 3.1.6
    lxml 6.0.2
    platformdirs 4.5.1
    pycountry 24.6.1
    PyYAML 6.0.3
    requests 2.32.5
    wcwidth 0.2.14
-->
<link href="draft-youssef-na-jsonrpc.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  --font-title: "Sofia Sans Semi Condensed", sans-serif;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
section {
  clear: both;
}
.section-number {
  padding-right: 0.5em;
}
h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-title);
  font-weight: 680;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
  vertical-align: top;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
  & :is(ol, ul) {
    margin-left: 1em;
  }
}
li {
  margin: 0 0 0.25em 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
  & li {
    margin-top: 0.5em;
  }
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  margin: 0 0 0 2em;
  & li {
    margin: 0;
    & :first-child { margin-top: 0; }
    & :last-child { margin-bottom: 0; }
  }
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
  &.olPercent {
    --indent: 5ch;
    & > dt {
      min-width: calc(var(--indent) - 2ch);
    }
  }
  &.olPercent > dt {
    float: none;
  }

  dl > dd > & {
    margin-top: 0.5em;
    margin-bottom: 0;
  }
}
dl:not(.dlNewline) > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
  & > :is(:first-child, .break:first-child + *) {
    margin-top: 0;
  }
  & > :is(:last-child) {
    margin-bottom: 0;
  }
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
  caption-side: bottom;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    /* In the horizontal direction, sometimes people make over-sized figures.
       Scrollbars for those is therefore necessary: auto adds them as necessary..
       In the vertical direction, the line-height can combine with the font
       asender/descender height to produce scrollbars: hidden avoids that. */
    overflow: auto hidden;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: auto;
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
  &[href] {
    color: var(--pilcrow-weak);
    &:hover { text-decoration: none; }
  }
}
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
  & dt {
    width: var(--identifier-width);
    min-width: var(--identifier-width);
    clear: left;
    float: left;
    text-align: right;
    margin-right: 1ch;
  }
  & dd {
    margin: 0;
    margin-left: calc(1em + var(--identifier-width)) !important;
    min-width: 5em;
  }
  & .authors {
    & .author {
      display: inline-block;
      margin-right: 1.5em;
    }
    & .org {
      font-style: italic;
    }
  }
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;

  & nav {
    & ul {
      margin: 0 0.5em 0 0;
      padding: 0;
      list-style: none;
    }
    & li {
      line-height: 1.3em;
      margin: 2px 0;
      padding-left: 1.2em;
      text-indent: -1.2em;
    }
  }
  & a.xref {
    white-space: normal;
  }
}

.references {
  & > dt {
    text-align: right;
    font-weight: bold;
    min-width: 10ch;
    margin-right: 1.5ch;
    &:target::before {
      content: "⇒";
      margin: 0 10px 0 -25px;
    }
  }
  & > dd {
    margin-left: 12ch !important;
    overflow: visible;
    & .refInstance {
      margin-bottom: 0.8em;
    }
    & .ascii {
      margin-bottom: 0.25em;
    }
  }
}

#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  max-width: 20em;
  margin: 1em auto 1em 0;

  & .nameRole {
    font-weight: 700;
    margin-left: 0;
  }
  & .label {
    margin: 0.5em 0;
  }
  & .type {
    display: none;
  }
  & .alternative-contact {
    margin: 0.5em 0 0.25em 0;
  }
  & .non-ascii {
    margin: 0 0 0 2em;
  }
  & div.left {
    text-align: left;
  }
  & div.right {
    text-align: right;
  }
}

hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

/* Comments */
.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}

@media screen {
  #toc nav {
    font-family: var(--font-title);
    font-weight: 360;
    & > ul { margin-bottom: 2em; }
    & ul {
      margin: 0 0 0 4px;
      & :is(p, li) {
        margin: 2px 0;
      }
    }
  }
  #toc a.toplink {
    float: right;
  }
}
@media not screen {
  #toc a.toplink {
    display: none;
  }
}


/* TOC layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
    &::before { /* css hamburger */
      float: right;
      position: relative;
      width: 1em;
      height: 1px;
      left: -164px;
      margin: 8px 0 0 0;
      background: white none repeat scroll 0 0;
      box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
      content: "";
    }
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active {
    opacity: 1;
    & nav { display: block; }
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:is(:link, :focus, :hover),
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin: 2px 0.5em 0;
  }
}

/* TOC layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
  #toc a.toplink {
    margin: 8px 0.5em 0;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Implementation of JSON-RPC in kotlinx.rp</td>
<td class="right">January 2026</td>
</tr></thead>
<tfoot><tr>
<td class="left">Shoaib</td>
<td class="center">Expires 9 July 2026</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-youssef-na-jsonrpc-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2026-01" class="published">January 2026</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2026-07-09">9 July 2026</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">Y. Shoaib</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Implementation of JSON-RPC in kotlinx.rpc</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document specifies an implementation of the JSON-RPC 2.0 protocol in the kotlinx.rpc Kotlin Multiplatform library. It provides both a core, transport-agnostic API, as well as Ktor integrations. Further, a quasi-protocol is defined to support bidirectional streaming via Flows over JSON-RPC.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-about-this-document">
<a href="#name-about-this-document" class="section-name selfRef">About This Document</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">
        The latest revision of this draft can be found at <span><a href="https://kyay10.github.io/json-rpc-rfc/draft-youssef-na-jsonrpc.html">https://kyay10.github.io/json-rpc-rfc/draft-youssef-na-jsonrpc.html</a></span>.
        Status information for this document may be found at <span><a href="https://datatracker.ietf.org/doc/draft-youssef-na-jsonrpc/">https://datatracker.ietf.org/doc/draft-youssef-na-jsonrpc/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">Source for this draft and an issue tracker can be found at
        <span><a href="https://github.com/kyay10/json-rpc-rfc">https://github.com/kyay10/json-rpc-rfc</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 5 July 2026.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2026 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-goals" class="internal xref">Goals</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="auto internal xref">1.2</a>.  <a href="#name-non-goals" class="internal xref">Non-Goals</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-core-apis" class="internal xref">Core APIs</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="auto internal xref">2.1</a>.  <a href="#name-notifications" class="internal xref">Notifications</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="auto internal xref">2.2</a>.  <a href="#name-reserved-method-names" class="internal xref">Reserved method names</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="auto internal xref">2.3</a>.  <a href="#name-parameter-encoding" class="internal xref">Parameter encoding</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.4">
                <p id="section-toc.1-1.2.2.4.1"><a href="#section-2.4" class="auto internal xref">2.4</a>.  <a href="#name-ids" class="internal xref">Ids</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.5">
                <p id="section-toc.1-1.2.2.5.1"><a href="#section-2.5" class="auto internal xref">2.5</a>.  <a href="#name-serialization" class="internal xref">Serialization</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.6">
                <p id="section-toc.1-1.2.2.6.1"><a href="#section-2.6" class="auto internal xref">2.6</a>.  <a href="#name-errors" class="internal xref">Errors</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.7">
                <p id="section-toc.1-1.2.2.7.1"><a href="#section-2.7" class="auto internal xref">2.7</a>.  <a href="#name-batching" class="internal xref">Batching</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.8">
                <p id="section-toc.1-1.2.2.8.1"><a href="#section-2.8" class="auto internal xref">2.8</a>.  <a href="#name-transport" class="internal xref">Transport</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.9">
                <p id="section-toc.1-1.2.2.9.1"><a href="#section-2.9" class="auto internal xref">2.9</a>.  <a href="#name-entrypoints" class="internal xref">Entrypoints</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-ktor" class="internal xref">Ktor</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-transport-2" class="internal xref">Transport</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-client" class="internal xref">Client</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="auto internal xref">3.3</a>.  <a href="#name-server" class="internal xref">Server</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-flow-support" class="internal xref">Flow support</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-appendix-a-ktor-client-api" class="internal xref">Appendix A: Ktor Client API</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#appendix-B" class="auto internal xref">Appendix B</a>.  <a href="#name-appendix-b-ktor-server-api" class="internal xref">Appendix B: Ktor Server API</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#appendix-C" class="auto internal xref"></a><a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#appendix-D" class="auto internal xref"></a><a href="#name-authors-address" class="internal xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1"><a href="https://www.jsonrpc.org/specification">JSON-RPC 2.0</a> is a stateless remote procedure call (RPC) protocol based on JavaScript Object Notation (JSON). It has a simple request-response flow and is transport agnostic.
<a href="https://github.com/Kotlin/kotlinx-rpc">Kotlinx.rpc</a> is a Kotlin Multiplatform (KMP) library that provides RPC abstractions for both clients and servers (hereafter referred to as endpoints).
The library already has support for <a href="https://grpc.io/">gRPC</a> alongside its bespoke krpc protocol. It supports single responses via suspend functions, and bidirectional streaming via flows. It also supports marshalling exceptions.<a href="#section-1-1" class="pilcrow">¶</a></p>
<div id="goals">
<section id="section-1.1">
        <h3 id="name-goals">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-goals" class="section-name selfRef">Goals</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-1.1-1.1">
            <p id="section-1.1-1.1.1">Provide a full implementation of JSON-RPC 2.0 protocol in kotlinx.rpc<a href="#section-1.1-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-1.2">
            <p id="section-1.1-1.2.1">Support for both suspend functions and flows between Kotlin endpoints<a href="#section-1.1-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-1.3">
            <p id="section-1.1-1.3.1">Simple compatibility for suspend functions with non-Kotlin endpoints<a href="#section-1.1-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-1.4">
            <p id="section-1.1-1.4.1">Maintain backwards compatibility<a href="#section-1.1-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-1.5">
            <p id="section-1.1-1.5.1">Add a minimal API surface (while reusing existing APIs in kotlinx.rpc core)<a href="#section-1.1-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-1.6">
            <p id="section-1.1-1.6.1">Stay transport-agnostic<a href="#section-1.1-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-1.7">
            <p id="section-1.1-1.7.1">Provide Ktor integrations<a href="#section-1.1-1.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-1.8">
            <p id="section-1.1-1.8.1">No code changes, instead the implementation shall live in new module(s)<a href="#section-1.1-1.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.1-1.9">
            <p id="section-1.1-1.9.1">No changes to the compiler plugin<a href="#section-1.1-1.9.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="non-goals">
<section id="section-1.2">
        <h3 id="name-non-goals">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-non-goals" class="section-name selfRef">Non-Goals</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-1.2-1.1">
            <p id="section-1.2-1.1.1">Extend or modify JSON-RPC 2.0 protocol<a href="#section-1.2-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.2-1.2">
            <p id="section-1.2-1.2.1">Compatibility for flows with non-Kotlin endpoints (since JSON-RPC 2.0 does not provide streaming semantics)<a href="#section-1.2-1.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="core-apis">
<section id="section-2">
      <h2 id="name-core-apis">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-core-apis" class="section-name selfRef">Core APIs</a>
      </h2>
<div id="notifications">
<section id="section-2.1">
        <h3 id="name-notifications">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-notifications" class="section-name selfRef">Notifications</a>
        </h3>
<p id="section-2.1-1">JSON-RPC defines notifications as requests that must not be responded to.
Importantly, the server can't repsond to them with errors, either.
While it seems natural to use a <code>Unit</code> return type for notifications, it can be surprising to the user that errors aren't propagated.
To sidestep this problem, a custom <code>NotificationOk</code> return type is provided for notifications:<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<div class="lang-kotlin sourcecode" id="section-2.1-2">
<pre>
public data object NotificationOk
</pre><a href="#section-2.1-2" class="pilcrow">¶</a>
</div>
<p id="section-2.1-3">For example:<a href="#section-2.1-3" class="pilcrow">¶</a></p>
<div class="lang-kotlin sourcecode" id="section-2.1-4">
<pre>
@Rpc interface Foo {
    suspend fun noResponse(): NotificationOk
    suspend fun mightError()
}
</pre><a href="#section-2.1-4" class="pilcrow">¶</a>
</div>
<p id="section-2.1-5"><code>noResponse</code> is a notification, while <code>mightError</code> is a normal request that can result in an exception.<a href="#section-2.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="reserved-method-names">
<section id="section-2.2">
        <h3 id="name-reserved-method-names">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-reserved-method-names" class="section-name selfRef">Reserved method names</a>
        </h3>
<p id="section-2.2-1">While JSON-RPC reserves method names starting with <code>rpc.</code>, the implementation shall make no effort to enforce this restriction.
Instead, we assume that, if the user defines such a method, they know what they are doing.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="parameter-encoding">
<section id="section-2.3">
        <h3 id="name-parameter-encoding">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-parameter-encoding" class="section-name selfRef">Parameter encoding</a>
        </h3>
<p id="section-2.3-1">JSON-RPC allows parameters in a request to be passed by-position (as an array) or by-name (as an object).
Since we'd like to support the full JSON-RPC spec, we provide a <code>ParameterEncoding</code> enum:<a href="#section-2.3-1" class="pilcrow">¶</a></p>
<div class="lang-kotlin sourcecode" id="section-2.3-2">
<pre>
public enum class ParameterEncoding { ByName, ByPosition }
</pre><a href="#section-2.3-2" class="pilcrow">¶</a>
</div>
<p id="section-2.3-3">API methods should have <code>ByName</code> as a default where possible, since it's more human-readable.
The choice of parameter encoding is configurable on the client only. The server must support both encodings.
A minor complication arises with the currently-experimental <a href="https://github.com/Kotlin/KEEP/blob/master/proposals/context-parameters.md">context parameters</a>, since context parameters may have no name.
In that case, they're assumed to have the special name <code>&lt;contextN&gt;</code>, where <code>N</code> is the index of the context parameter in the parameter list.
An alternative is to simply not support unnamed context parameters with by-name encoding, but that seems less than ideal.<a href="#section-2.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ids">
<section id="section-2.4">
        <h3 id="name-ids">
<a href="#section-2.4" class="section-number selfRef">2.4. </a><a href="#name-ids" class="section-name selfRef">Ids</a>
        </h3>
<p id="section-2.4-1">Every JSON-RPC request must have an id, except for notifications.
We thus specify that the client must generate numerical ids and ensure their uniqueness.<a href="#section-2.4-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="serialization">
<section id="section-2.5">
        <h3 id="name-serialization">
<a href="#section-2.5" class="section-number selfRef">2.5. </a><a href="#name-serialization" class="section-name selfRef">Serialization</a>
        </h3>
<p id="section-2.5-1">In the presence of complex data in the parameters or return types of API methods, serialization is necessary.
Since JSON-RPC is JSON-based, we can only support String-based serialization formats.
Hence, we use <code>StringFormat</code> from <code>kotlinx.serialization</code> as the serialization abstraction.<a href="#section-2.5-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="errors">
<section id="section-2.6">
        <h3 id="name-errors">
<a href="#section-2.6" class="section-number selfRef">2.6. </a><a href="#name-errors" class="section-name selfRef">Errors</a>
        </h3>
<p id="section-2.6-1">JSON-RPC requires an error code in error responses.
Kotlin exceptions don't come with error codes, so, we provide a public <code>JsonRpcException</code> type as follows:<a href="#section-2.6-1" class="pilcrow">¶</a></p>
<div class="lang-kotlin sourcecode" id="section-2.6-2">
<pre>
public class JsonRpcException(val code: Int, message: String): IllegalStateException(message)
</pre><a href="#section-2.6-2" class="pilcrow">¶</a>
</div>
<p id="section-2.6-3">We make no effort to validate error codes, instead leaving it up to the user to provide appropriate codes.
For all other exceptions, we use the error code <code>-32000</code>, which is within the server error range defined by JSON-RPC.
Importantly, JSON-RPC reserves some error codes for special RPC errors, with the relevant ones being (adapted from JSON-RPC 2.0 §5.1):<a href="#section-2.6-3" class="pilcrow">¶</a></p>
<table class="center" id="table-1">
          <caption><a href="#table-1" class="selfRef">Table 1</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Code</th>
              <th class="text-center" rowspan="1" colspan="1">Message</th>
              <th class="text-center" rowspan="1" colspan="1">Meaning</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">-32700</td>
              <td class="text-center" rowspan="1" colspan="1">Parse error</td>
              <td class="text-center" rowspan="1" colspan="1">Invalid JSON was received by the server</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">-32600</td>
              <td class="text-center" rowspan="1" colspan="1">Invalid Request</td>
              <td class="text-center" rowspan="1" colspan="1">The JSON sent is not a valid Request object</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">-32601</td>
              <td class="text-center" rowspan="1" colspan="1">Method not found</td>
              <td class="text-center" rowspan="1" colspan="1">The method does not exist / is not available</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">-32602</td>
              <td class="text-center" rowspan="1" colspan="1">Invalid params</td>
              <td class="text-center" rowspan="1" colspan="1">Invalid method parameter(s)</td>
            </tr>
          </tbody>
        </table>
<p id="section-2.6-5">These errors must be used by the implementation where appropriate.
The error response's <code>message</code> field must contain the Exception's message.
The error response's <code>data</code> field must contain, at a minimum, the fully-qualified name of the Exception class and the stacktrace.
Other fields may be added as necessary.
Alternatively, <a href="https://github.com/Kotlin/kotlinx-rpc/blob/2b895329b779d6560363f4fb79eed0e27ea82e07/krpc/krpc-core/src/commonMain/kotlin/kotlinx/rpc/krpc/internal/SerializedException.kt">SerializedException</a>, which is internally used by Krpc, may be moved into core and used for this purpose.<a href="#section-2.6-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="batching">
<section id="section-2.7">
        <h3 id="name-batching">
<a href="#section-2.7" class="section-number selfRef">2.7. </a><a href="#name-batching" class="section-name selfRef">Batching</a>
        </h3>
<p id="section-2.7-1">JSON-RPC supports batching of requests into a single request (as an array).
The server implementation must support batching.
Batching on the client is to be done on a best-effort basis, i.e., the client may choose to batch requests or not.
The relaxed constraint is to ensure that the client can make requests in a timely fashion.<a href="#section-2.7-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="transport">
<section id="section-2.8">
        <h3 id="name-transport">
<a href="#section-2.8" class="section-number selfRef">2.8. </a><a href="#name-transport" class="section-name selfRef">Transport</a>
        </h3>
<p id="section-2.8-1">Since the protocol communicates through JSON, all we require is a transport that can send and receive strings.
We thus define a simple <code>JsonRpcTransport</code> interface as follows:<a href="#section-2.8-1" class="pilcrow">¶</a></p>
<div class="lang-kotlin sourcecode" id="section-2.8-2">
<pre>
public interface JsonRpcTransport : CoroutineScope {
    suspend fun send(message: String)
    suspend fun receive(): String
}
</pre><a href="#section-2.8-2" class="pilcrow">¶</a>
</div>
<p id="section-2.8-3">Importantly, the transport is also a <code>CoroutineScope</code>, to allow for cancellation when needed. IT also thus provides a <code>coroutineContext</code> which determines important coroutine properties such as the dispatcher.<a href="#section-2.8-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="entrypoints">
<section id="section-2.9">
        <h3 id="name-entrypoints">
<a href="#section-2.9" class="section-number selfRef">2.9. </a><a href="#name-entrypoints" class="section-name selfRef">Entrypoints</a>
        </h3>
<p id="section-2.9-1">Kotlinx.rpc provides <code>RpcClient</code> and <code>RpcServer</code> interfaces as the main entrypoints for clients and servers, respectively.
We thus provide <code>JsonRpcClient</code> and <code>JsonRpcServer</code> implementations of these interfaces:<a href="#section-2.9-1" class="pilcrow">¶</a></p>
<div class="lang-kotlin sourcecode" id="section-2.9-2">
<pre>
public class JsonRpcClient(
        private val format: StringFormat,
        private val encoding: ParameterEncoding = ParameterEncoding.ByName,
        private val transport: JsonRpcTransport,
): RpcClient
public class JsonRpcServer(
    private val format: StringFormat,
    private val transport: JsonRpcTransport,
): RpcServer {
    public fun close(message: String? = null) { ... }
    public suspend fun awaitCompletion() { ... }
}
</pre><a href="#section-2.9-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="ktor">
<section id="section-3">
      <h2 id="name-ktor">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-ktor" class="section-name selfRef">Ktor</a>
      </h2>
<p id="section-3-1">We provide Ktor integrations for both client and server.<a href="#section-3-1" class="pilcrow">¶</a></p>
<div id="transport-1">
<section id="section-3.1">
        <h3 id="name-transport-2">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-transport-2" class="section-name selfRef">Transport</a>
        </h3>
<p id="section-3.1-1">Our canonical Ktor transport implementation, using Ktor's <code>WebSocketSession</code>, is as follows:<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<div class="lang-kotlin sourcecode" id="section-3.1-2">
<pre>
@InternalRpcApi
public class KtorTransport(private val webSocketSession: WebSocketSession) : JsonRpcTransport, CoroutineScope by webSocketSession {
    override suspend fun send(message: String) = webSocketSession.send(message)

    override suspend fun receive(): KrpcTransportMessage = webSocketSession.incoming.receive() as? Frame.Text ?: error("Unsupported websocket frame type: ${message::class}. Expected Frame.Text")
}
</pre><a href="#section-3.1-2" class="pilcrow">¶</a>
</div>
<p id="section-3.1-3">We use <code>@InternalRpcApi</code> from core to denote that this API is not intended for public use.<a href="#section-3.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="client">
<section id="section-3.2">
        <h3 id="name-client">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-client" class="section-name selfRef">Client</a>
        </h3>
<p id="section-3.2-1">Ktor client APIs are provided in <span><a href="#appendix-a-ktor-client-api" class="internal xref">Appendix A</a> (<a href="#appendix-a-ktor-client-api" class="auto internal xref">Appendix A</a>)</span>.
Importantly, we provide an <code>installJsonRpc</code> extension function that takes in a <code>StringFormat</code> and an optional <code>ParameterEncoding</code>, and installs the necessary WebSocket support.
<code>HttpClient.rpc</code> sets up the websocket and allows the user to configure the url and other <code>HttpRequestBuilder</code> properties; the returned <code>JsonRpcClient</code> can then be used to access RPC services<a href="#section-3.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="server">
<section id="section-3.3">
        <h3 id="name-server">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-server" class="section-name selfRef">Server</a>
        </h3>
<p id="section-3.3-1">Ktor server APIs are provided in <span><a href="#appendix-b-ktor-server-api" class="internal xref">Appendix B</a> (<a href="#appendix-b-ktor-server-api" class="auto internal xref">Appendix B</a>)</span>.
Importantly, we provide an <code>installJsonRpc</code> extension function that takes in a <code>StringFormat</code> and installs the necessary WebSocket support.
<code>Route.rpc</code> sets up the websocket route and allows the user to register services inside the block.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="flow-support">
<section id="section-4">
      <h2 id="name-flow-support">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-flow-support" class="section-name selfRef">Flow support</a>
      </h2>
<p id="section-4-1">JSON-RPC <em>technically</em> does not prohibit multiple responses to a single request, but it does not define any semantics for it.
We thus provide our own quasi-protocol on top of JSON-RPC to support flows.
Since kotlinx.rpc explicitly supports bidirectional streaming, we'll must have bidirectional communication between endpoints.
Every Flow that's communicated between endpoints is assigned a unique id (unrelated to request/response ids). Communication thus involves simply sending the id.
Since Flows are cold by default, our quasi-protocol is pull-based, i.e., the receiver requests items from the sender.
We reserve 2 unique method names "kotlinx.rpc.jsonrpc.internal.nextFlowValue" and "kotlinx.rpc.jsonrpc.internal.cancelFlow" for this purpose.
When the receiver wants the next item from the Flow, it sends a request with this method name and the Flow id as the sole parameter.
The sender then responds with the next item from the Flow (and can error if necessary).
Finally, when the Flow is complete, the sender simply returns an error response with code <code>-32001</code> to indicate completion.
If the flow is cancelled by the client, they must send a request with method <code>cancelFlow</code> and the Flow id as the sole parameter.
For instance, consider the following service:<a href="#section-4-1" class="pilcrow">¶</a></p>
<div class="lang-kotlin sourcecode" id="section-4-2">
<pre>
@Rpc interface Numbers {
    fun getNumbers(): Flow&lt;Int&gt;
}
</pre><a href="#section-4-2" class="pilcrow">¶</a>
</div>
<p id="section-4-3">When the client calls <code>getNumbers</code>, nothing happens yet, since Flows are cold.
When the client starts collecting the Flow, the client sends a request to the server to invoke <code>getNumbers</code>.
The server responds with a Flow id (say, <code>42</code>).
Then, the client sends a request with method <code>nextFlowValue</code> and parameter <code>42</code>.
The server responds with the next number in the Flow.
If the client cancels the Flow, it sends a request with method <code>cancelFlow</code> and parameter <code>42</code>.
If the server-side Flow completes, it responds to the next <code>nextFlowValue</code> request with an error code <code>-32001</code>.
This does not interfere with normal JSON-RPC requests and responses, since the quasi-protocol uses reserved method names.<a href="#section-4-3" class="pilcrow">¶</a></p>
<p id="section-4-4">This approach may seem heavyweight since every item in the Flow requires a round-trip. Batching mitigates this somewhat.
Additonally, <code>Flows</code> have excellent buffering operators that can be used to ensure that the receiver always has items to process.
Our quasi-protocol is simple enough to be implemented in non-Kotlin endpoints, if desired.<a href="#section-4-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="appendix-a-ktor-client-api">
<section id="appendix-A">
      <h2 id="name-appendix-a-ktor-client-api">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-appendix-a-ktor-client-api" class="section-name selfRef">Appendix A: Ktor Client API</a>
      </h2>
<p id="appendix-A-1">The Ktor client API is as follows:<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<div class="lang-kotlin sourcecode" id="appendix-A-2">
<pre>
internal val JsonRpcClientFormatKey = AttributeKey&lt;StringFormat&gt;("JsonRpcClientFormatKey")
internal val JsonRpcClientEncodingKey = AttributeKey&lt;ParameterEncoding&gt;("JsonRpcClientEncodingKey")
public fun HttpClientConfig&lt;*&gt;.installJsonRpc(format: StringFormat, encoding: ParameterEncoding = ParameterEncoding.ByName) {
    pluginOrNull(WebSockets) ?: install(WebSockets)
    attributes.put(JsonRpcClientFormatKey, format)
    attributes.put(JsonRpcClientEncodingKey, encoding)
}

public fun HttpClient.rpc(
    urlString: String,
        format: StringFormat = attributes[JsonRpcClientFormatKey],
        encoding: ParameterEncoding = attributes[JsonRpcClientEncodingKey],
    block: HttpRequestBuilder.() -&gt; Unit = {},
): JsonRpcClient = rpc {
    url(urlString)
    block()
}

public fun HttpClient.rpc(
        format: StringFormat = attributes[JsonRpcClientFormatKey],
        encoding: ParameterEncoding = attributes[JsonRpcClientEncodingKey],
    block: HttpRequestBuilder.() -&gt; Unit = {},
): JsonRpcClient {
    pluginOrNull(WebSockets)
        ?: error("RPC for client requires $WebSockets plugin to be installed firstly")
    return JsonRpcClient(format, encoding, KtorTransport(webSocketSession(block)))
}
</pre><a href="#appendix-A-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="appendix-b-ktor-server-api">
<section id="appendix-B">
      <h2 id="name-appendix-b-ktor-server-api">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-appendix-b-ktor-server-api" class="section-name selfRef">Appendix B: Ktor Server API</a>
      </h2>
<p id="appendix-B-1">The Ktor server API is as follows:<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<div class="lang-kotlin sourcecode" id="appendix-B-2">
<pre>
internal val JsonRpcServerFormatKey = AttributeKey&lt;StringFormat&gt;("JsonRpcServerFormatKey")
public fun Application.installJsonRpc(format: StringFormat) {
    pluginOrNull(WebSockets) ?: install(WebSockets)
    attributes.put(JsonRpcServerFormatKey, format)
}
public class JsonRpcRoute(
    webSocketSession: DefaultWebSocketServerSession,
    rpcServer: RpcServer,
) : DefaultWebSocketServerSession by webSocketSession, RpcServer by rpcServer

@KtorDsl
public fun Route.rpc(
    path: String,
    format: StringFormat = attributes[JsonRpcClientFormatKey],
    builder: suspend JsonRpcRoute.() -&gt; Unit,
) = route(path) { rpc(builder) }

@KtorDsl
public fun Route.rpc(
    format: StringFormat = attributes[JsonRpcClientFormatKey],
    builder: suspend JsonRpcRoute.() -&gt; Unit,
) {
    application.pluginOrNull(WebSockets)
        ?: error("RPC for server requires $WebSockets plugin to be installed firstly")
    webSocket {
        val server = JsonRpcServer(format, KtorTransport(this))
        builder(JsonRpcRoute(this, server))
        server.awaitCompletion()
    }
}
</pre><a href="#appendix-B-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="acknowledgments">
<section id="appendix-C">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-C-1">The design approach and implementation has been heavily inspired by
the kotlinx.rpc krpc <a href="https://github.com/Kotlin/kotlinx-rpc/tree/1a45abae912a783bf3f610feabaec53d8f7a53e4/krpc">implementation</a>.<a href="#appendix-C-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-D">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Youssef Shoaib</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:canonballt@gmail.com" class="email">canonballt@gmail.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
